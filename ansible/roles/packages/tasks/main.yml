---
- name: "Find installable package tasks"
  find:
    paths: "{{ role_path }}/tasks/packages"
    file_type: file
    patterns:
      - "{{ ansible_os_family | lower }}.yml"
      - common.yml
    use_regex: false
    depth: 2
    recurse: true
  register: installable_packages

- name: "Dynamically include installable packages tasks"
  include_tasks: "{{ package.path }}"
  loop: "{{ installable_packages.files | sort(attribute='path') }}"
  loop_control:
    loop_var: package
    label: "{{ package.path | dirname | basename }}"
  when:
    - "package.path | dirname | basename not in ansible_skip_tags"

