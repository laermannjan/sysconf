---
version: 1.0.1
commands:
  - name: connect_dev_db
    namespace: alcemy
    tags:
      - postgres
      - ssh
      - db
      - database
      - tunnel
    command: "ssh -o ServerAliveInterval=60 -o ServerAliveCountMax=10 -i ~/.ssh/id_alcemy -T -N -L 5432:dev-db-instance.cxwee7sgwz6s.eu-central-1.rds.amazonaws.com:5432 ec2-user@alhambra-dev.alcemy.tech"
    description: "Forward DEV postgres' port 5432 to localhost and keep alive. Along with disabling pseudo-[T]ty allocation and executio[N] of remote commands."
  - name: connect_prod_db
    namespace: alcemy
    tags:
      - postgres
      - ssh
      - db
      - database
      - tunnel
    command: "ssh -o ServerAliveInterval=60 -o ServerAliveCountMax=10 -i ~/.ssh/id_alcemy -T -N -L 5432:prod-db-instance.cxwee7sgwz6s.eu-central-1.rds.amazonaws.com:5432 ec2-user@alhambra-prod.alcemy.tech"
    description: "Forward PROD postgres' port 5432 to localhost and keep alive. Along with disabling pseudo-[T]ty allocation and executio[N] of remote commands."
  - name: kubeconfig_set_context
    namespace: alcemy
    tags:
      - kubernetes
      - k8s
      - argo
      - devops
    command: "aws eks --region eu-central-1 update-kubeconfig --name #"
    description: "Configure local access to [prod|dev] kubernetes cluster. Will make the cluster available to kubectl and other tools respecting ~/.kube/config."
  - name: gls_import_csv_subsembly
    namespace: Ledger
    tags:
      - money
      - gls
      - ledger
      - import
      - csv
    command: "reckon --contains-header 1 --date-format '%Y-%m-%d' --ledger-date-format '%Y-%m-%d' --csv-separator ',' --currency 'EUR' --ignore-columns 1,2,3,4,5,6,7,8,10,12,14,15,16,17,19,20,21,22,23,26,28,29,30,31,32,33,34,35,36,37,38,39,40,41 --date-column 1 --money-column 2 --account 'GemeinsamesVermoegen:Bank:GLS:Giro' --default-outof-account 'Einkuenfte:Unbekannt' --default-into-account 'Ausgaben:Unbekannt' --account-tokens # -f #  -o # --unattend"
    description: "Import transactions to a ledger file from the GLS Bank \"Subsembly CSV\" export (only available from ios app)"
  - name: gls_import_csv_camt_sparkasse
    namespace: Ledger
    tags:
      - money
      - gls
      - ledger
      - import
      - csv
    command: "reckon -f # --money-column 5 --date-column 1 --contains-header 1 --csv-separator ';' --comma-separates-cents --currency 'EUR' --date-format '%d.%m.%Y' --ledger-date-format '%Y-%m-%d' --account 'Vermoegen:Bank:GLS:Giro' --ignore-columns 2,3,5,6,7,8,11,13 --account-tokens # -o #"
    description: "Import transactions to a ledger file from the GLS Bank \"Sparkasse CSV-CAMT\" export (only available from ios app)"
  - name: sparkasse_import_csv_camt
    namespace: Ledger
    tags:
      - ledger
      - money
      - csv
      - import
    command: "reckon --ignore-columns 1,3,4,6,7,8,9,10,11,14,16,17 --account 'Vermoegen:Bank:Sparkasse:Giro' --account-tokens #  -o # --csv-separator ';' --date-format '%d.%m.%y' --date-column 1 --money-column 5  --contains-header 1 --currency 'EUR' --suffix --comma-separates-cents -f #"
    description: "Import transactions to a ledger file from with `reckon` via a Sparkasse CSV-CAMT export."
  - name: gls_import_csv
    namespace: Ledger
    tags:
      - ledger
      - money
      - csv
      - import
    command: "reckon --ignore-columns 1,2,3,4,6,9,10,13,14,15,16,17,18,19 --date-column 1 --date-format '%d.%m.%Y' --money-column 5 --currency 'EUR' --suffix --csv-separator ';' --contains-header 1 --comma-separates-cents --account-tokens # -f # -o # --account 'GemeinsamesVermoegen:Bank:GLS:Giro'"
    description: "Import transactions to a ledger file with `reckon` via a GLS CSV export (from the NEW online banking)"
  - name: elevate
    namespace: alcemy
    tags:
      - aws
      - permissions
    command: aws iam add-user-to-group --group-name Elevated --user-name jan-laermann
    description: Add yourself to the elevated group granting additional permissions on alcemy aws. By default you have read-only as a standard user.
  - name: reset-known-hosts
    namespace: alcemy
    tags:
      - ssh
      - bastion
    command: ssh-keygen -R alhambra-dev.alcemy.tech && ssh-keygen -R alhambra-prod.alcemy.tech
    description: Reset the known-hosts keys for alcemy bastion hosts. This often happens when we change or add new ssh keys for team members.
  - name: fuzzy_find_aws_secret
    namespace: aws
    tags:
      - ""
    command: "aws secretsmanager get-secret-value --secret-id (aws secretsmanager list-secrets | jq -r '.[][] | .Name' | fzy) | jq -r .SecretString | tr -d '\\n' | pbcopy"
    description: "Let's you fuzzy find an aws secret and puts it into your clipboard."
